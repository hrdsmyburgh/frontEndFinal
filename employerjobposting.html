<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Post a Job | Employer Dashboard</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f8fafc;
            margin: 0;
            padding: 0;
        }

        main {
            padding: 40px 0;
        }

        .fs-form {
            max-width: 900px;
            margin: 0 auto;
            padding: 30px;
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        fieldset {
            border: none;
            margin-bottom: 25px;
        }

        .fs-fieldset-title {
            font-size: 1.2em;
            margin-bottom: 15px;
            color: #007bff;
        }

        .fs-layout__2-column fieldset {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .fs-field, .col-span-full, .fs-button-group {
            grid-column: 1 / -1;
        }

        .fs-label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .fs-input, textarea.fs-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 14px;
            transition: border 0.3s;
        }

        .fs-input:focus, textarea.fs-input:focus {
            border-color: #007bff;
            outline: none;
        }

        .fs-button {
            padding: 12px 24px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .fs-button:hover {
            background-color: #0056b3;
        }

        .fs-checkbox-field {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-top: 15px;
            grid-column: 1 / -1;
        }

        .fs-description {
            font-size: 0.9em;
            color: #555;
        }
    </style>
</head>

<body>
<main>
    <form id="jobForm" class="fs-form fs-layout__2-column">
        <fieldset>
            <legend class="fs-fieldset-title">Job Details</legend>

            <div class="fs-field">
                <label class="fs-label" for="jobtitle">Job Title</label>
                <input class="fs-input" id="jobtitle" name="jobtitle" required />
            </div>

            <div class="fs-field">
                <label class="fs-label" for="jobtype">Job Type</label>
                <input class="fs-input" id="jobtype" name="jobtype" required />
            </div>

            <div class="fs-field">
                <label class="fs-label" for="jobdetails">Job Description</label>
                <textarea class="fs-input" id="jobdetails" name="jobdetails" rows="5" required></textarea>
            </div>

            <div class="fs-field">
                <label class="fs-label" for="location">Job Location</label>
                <input class="fs-input" id="location" name="location" required />
            </div>

            <div class="fs-field">
                <label class="fs-label" for="vacancies">Number of Vacancies</label>
                <input class="fs-input" id="vacancies" name="vacancies" type="number" min="1" required />
            </div>

            <div class="fs-field">
                <label class="fs-label" for="salary">Salary Range</label>
                <input class="fs-input" id="salary" name="salary" required />
            </div>
        </fieldset>

        <fieldset>
            <legend class="fs-fieldset-title">Required Knowledge, Skills, and Abilities</legend>
            <div class="fs-field">
                <label class="fs-label" for="skills">Skills Required</label>
                <textarea class="fs-input" id="skills" name="skills" rows="5" required></textarea>
            </div>
        </fieldset>

        <fieldset>
            <legend class="fs-fieldset-title">Education & Experience</legend>
            <div class="fs-field">
                <label class="fs-label" for="experience">Experience/Education</label>
                <textarea class="fs-input" id="experience" name="experience" rows="5" required></textarea>
            </div>
        </fieldset>

        <div class="fs-checkbox-field col-span-full">
            <div class="fs-checkbox-wrapper">
                <input class="fs-checkbox" id="bgv-consent" name="bgv-consent" type="checkbox" value="bgv-consent" required />
            </div>
            <div>
                <label class="fs-label" for="bgv-consent">Posting Consent</label>
                <p class="fs-description">
                    By checking this box, you confirm that all information is accurate and you consent to receiving applications.
                </p>
            </div>
        </div>

        <div class="fs-button-group">
            <button class="fs-button" type="submit">Submit Job Post</button>
        </div>
    </form>
</main>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const jobForm = document.getElementById("jobForm");

    jobForm.addEventListener("submit", async (e) => {
        e.preventDefault();

        const token = localStorage.getItem("authToken");
        if (!token) {
            alert("‚ö†Ô∏è You must be logged in to post a job. Please log in first.");
            window.location.href = "loginpage.html";
            return;
        }

        // Use EXACT field names from your Job model
        const jobData = {
            title: document.getElementById("jobtitle").value.trim(),
            type: document.getElementById("jobtype").value.trim(),  // Changed from job_type to type
            description: document.getElementById("jobdetails").value.trim(),
            location: document.getElementById("location").value.trim(),
            salary_range: document.getElementById("salary").value.trim(),
            experience: document.getElementById("experience").value.trim(),  // Changed from education_experience to experience
            is_active: true
            // Removed: vacancies, skills_required (they don't exist in model)
        };

        try {
            const apiUrl = "http://127.0.0.1:8000/api/job/";
            const response = await fetch(apiUrl, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": `Token ${token}`
                },
                body: JSON.stringify(jobData)
            });

            if (response.ok) {
                alert("‚úÖ Job post submitted successfully!");
                jobForm.reset();
                // Optional: redirect to employer dashboard
                // window.location.href = "employeradminpage.html";
            } else {
                const errorData = await response.json();
                console.error("API Error:", errorData);
                alert("‚ùå Failed to post job. Check console for details.");
            }
        } catch (error) {
            console.error("Network Error:", error);
            alert("üö´ Network error: " + error.message);
        }
    });
});
</script>

</body>
</html>